#!/bin/bash
# postinst script for liborblze
#
# see: dh_installdeb(1)

set -e

SPIRVDIR=@spirvdir@
ZEBINDIR=@zebindir@

. /usr/share/debconf/confmodule

db_get liborb-lze/march
MARCH=${RET}
declare -a FEATURES=(@kernellist@)

case "$1" in
    configure)
	if command -v ocloc > /dev/null && [ -f ${SPIRVARCH} ] && [ -f ${ZEBINFILE} ]; then
	    for FEATURE in "${FEATURES[@]}"
	    do
	       echo "postinst SPIRV ${FEATURE} ocloc -device \`${MARCH}'" >&2
	       ocloc compile -spirv_input -file ${SPIRVDIR}/${FEATURE}_${MARCH}.spv -output ${ZEBINDIR}/${FEATURE}.bin -force_stos_opt -device :xe -output_no_suffix -q
	    done
	fi
	;;

    abort-upgrade|abort-remove|abort-deconfigure)
	;;

    *)
	echo "postinst called with unknown argument \`$1'" >&2
	exit 1
	;;
esac

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

#DEBHELPER#

exit 0
